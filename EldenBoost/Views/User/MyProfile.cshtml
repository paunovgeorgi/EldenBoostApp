@using EldenBoost.Common.Enumerations
@using EldenBoost.Extensions
@model IEnumerable<OrderCardViewModel>

@{
    ViewBag.Title = "My Profile";
    string levelBadge = "";
    string level = LevelType.Adventurer.ToString();

    var levels = new List<(decimal Threshold, LevelType Level)>
{
    (100, LevelType.Adventurer),
    (200, LevelType.Explorer),
    (500, LevelType.Pathfinder),
    (1000, LevelType.Trailblazer),
    (1500, LevelType.Vanguard),
    (2500, LevelType.Hero),
    (5000, LevelType.Champion),
    (10000, LevelType.Conqueror),
    (15000, LevelType.Legend),
    (25000, LevelType.Myth)
};

    foreach (var (threshold, levelType) in levels)
    {
        if (ViewBag.TotalSpent >= threshold) { level = levelType.ToString(); }
        else { break; }
    }

    LevelType levelEnum;
    if (Enum.TryParse(level, out levelEnum))
    {
        levelBadge = levelEnum switch
        {
            LevelType.Adventurer => "fa-solid fa-compass",
            LevelType.Explorer => "fa-solid fa-binoculars",
            LevelType.Pathfinder => "fa-solid fa-map",
            LevelType.Trailblazer => "fa-solid fa-fire",
            LevelType.Vanguard => "fa-solid fa-flag",
            LevelType.Hero => "fa-solid fa-medal",
            LevelType.Champion => "fa-solid fa-trophy",
            LevelType.Conqueror => "fa-solid fa-castle",
            LevelType.Legend => "fa-solid fa-scroll",
            LevelType.Myth => "fa-solid fa-star",
            _ => "fa-solid fa-question-circle"
        };
    }
  
    if (string.IsNullOrEmpty(ViewBag.ProfilePicture))
    {
        ViewBag.ProfilePicture = "https://i.pinimg.com/originals/ae/91/e4/ae91e4161c6f7e3c18815680aa75cf44.jpg";
    }
}

<form style="display:none">
    @Html.AntiForgeryToken()
</form>

<h2 class="text-center" style="margin-top:80px">@ViewBag.Title</h2>
<hr />

@if (User.IsAdmin())
{
    <div class="row justify-content-evenly mt-5 align-content-center" style="flex-direction:column">
        <div class="profile-pic">
            <img src="@ViewBag.ProfilePicture" class="" alt="Profile Picture">
            <div class="card-body">
                <h4 class="mt-1 text-center">@ViewBag.Username</h4>
                <hr />
            </div>
        </div>
        <button class="btn btn-outline-light" style="width:174px; align-self:center; border-top: 0px" onclick="openChangeProfilePicModal()">Change Profile Picture</button>
    </div>
}
else
{
    <div class="row justify-content-evenly mt-5 align-content-center" style="flex-direction:column">
        <div class="profile-pic">
            <img src="@ViewBag.ProfilePicture" class="" alt="...">
            <div class="card-body">
                <h4 class="mt-1 text-center">@ViewBag.Username</h4>
                <hr />
                <p class="card-text text-light">Total Orders: @ViewBag.TotalOrders</p>
                <p class="card-text text-light">Total Spent: @($"${ViewBag.TotalSpent:f2}")</p>
                <p class="card-text text-light">Level: @level <i class="@levelBadge" style="color: darkslategrey; font-weight: bold;"></i></p>

            </div>
        </div>
        <button class="btn btn-outline-light" style="width:174px; align-self:center; border-top: 0px" onclick="openChangeProfilePicModal()">Change Profile Picture</button>
    </div>

    @if (!Model.Any())
    {
        <h2 class="text-center" style="margin-top: 8px;">You don't have any orders.</h2>
    }

    <hr />

    <h2 class="text-center">Pending Orders</h2>

    <div class="row">
        @foreach (var order in Model.Where(m => m.Status == "Pending"))
        {
            <partial name="_OrderPartial" model="@order" />
        }
    </div>

    <hr />

    <h2 class="text-center">Active Orders</h2>

    <div class="row">
        @foreach (var order in Model.Where(m => m.Status == "Working"))
        {
            <partial name="_OrderPartial" model="@order" />
        }
    </div>

    <hr />
    <h2 class="text-center">Completed Orders</h2>


    <div class="row">
        @foreach (var order in Model.Where(m => m.Status == "Completed"))
        {
            <partial name="_OrderPartial" model="@order" />
        }
    </div>
}

<script src="~/js/profile-picture.js"></script>
<script src="~/js/rate-booster.js"></script>